# ソフトウェア設計ガイドライン（アーキテクチャ編）

## 基本設計方針

- プロジェクトの規模に応じて適切なアーキテクチャを採用する
- 設計段階でディレクトリ構成、モジュール境界、依存関係を定義してから実装に入る
- ビジネスロジックを中心に据え、フレームワークや外部ライブラリに依存しすぎない

---

## アーキテクチャ選定指針

### 小規模（PoC, プロトタイプ）

- KISS原則を優先し、シンプルな三層構造（UI層 / サービス層 / データ層）を採用
- 将来的な拡張に備えて責務分離だけは守る

### 中規模（一般的な業務アプリ）

- **クリーンアーキテクチャ**を基本とする
    - **層構造**:
        - **Entities（ドメインモデル）**: ビジネスルールを表現
        - **Use Cases（アプリケーション層）**: ビジネスロジックの流れを定義
        - **Interface Adapters（インフラ層）**: DB, API, UIとの接続を担う
        - **Frameworks & Drivers（外部層）**: Webフレームワークや外部ライブラリ
    - 内側の層は外側に依存しない（依存性逆転の原則）

### 大規模（巨大システム）

- *ドメイン駆動設計（DDD）**を採用
    - *境界づけられたコンテキスト（Bounded Context）**を定義し、チーム単位で独立性を確保
    - 各コンテキストごとにクリーンアーキテクチャを適用
    - ユビキタス言語を導入し、コード・設計・ドキュメントで一貫して使う
    - 複雑な依存関係はイベント駆動（Pub/Sub, CQRS, Event Sourcing など）で解決

---

## 実装上のルール

1. **層の越境禁止**
    - UI層から直接DBを叩かない
    - インフラ層の実装をドメイン層に直接書かない
2. **依存性逆転**
    - 内部層（ドメイン, アプリケーション）は外部層に依存しない
    - インターフェースを定義し、外部実装を注入する
3. **コードの配置**
    - 各層ごとにディレクトリを分ける
    - `domain/`, `application/`, `infrastructure/`, `interfaces/` など命名を明示する
4. **テスト戦略**
    - ドメイン層はユニットテストを充実させる
    - インフラ層はモック・スタブを利用して依存を切り離す
    - E2Eテストは最小限にし、主要ユースケースをカバー

---

## 実装フロー

1. **設計**
    - アーキテクチャスタイルの選定（小/中/大規模）
    - 層構造・コンテキスト境界を定義
    - ディレクトリ構成を提示
    - インターフェース一覧を明示
2. **実装**
    - 設計に沿ってコードを作成
    - 依存関係を守ること
    - 責務が曖昧な実装を避ける
3. **自己レビュー**
    - アーキテクチャ原則（依存性逆転、責務分離）が守られているか確認
    - クラス間の結合度が高すぎないか確認
    - テスト可能性をレビュー